<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 bg-gray-50 dark:bg-gray-900">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Left Column: Forms -->
    <div class="space-y-4">
      <!-- Hidden Cover Letter Form -->
      <div id="new-cover_letter-form" class="hidden">
        <%= form_with(model: CoverLetter.new, url: cover_letters_path, data: { remote: true }, class: "space-y-4") do |form| %>
          <%= form.text_field :subject, 
                placeholder: "Cover letter subject", 
                class: "block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900" %>
          <%= form.text_area :latex_source, 
                placeholder: "LaTeX source", 
                class: "hidden w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900" %>
          <div id="cover_letter-editor" class="border border-gray-200 dark:border-gray-700 rounded-md" style="height: 400px; width: 100%;"></div>
          <%= form.submit "Create", class: "w-full rounded-md px-4 py-2 bg-blue-600 hover:bg-blue-500 dark:bg-blue-700 dark:hover:bg-blue-600 text-white font-medium shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        <% end %>
      </div>
      <!-- Job Application Form -->
      <%= form_with(model: job_application, class: "space-y-6") do |form| %>
        <%= form.hidden_field :job_post_id, value: params[:job_post_id] %>
        <% if job_application.errors.any? %>
          <div class="bg-red-50 dark:bg-red-900 text-red-500 dark:text-red-300 px-4 py-3 rounded-md shadow-md">
            <h2 class="font-medium text-lg"><%= pluralize(job_application.errors.count, "error") %> prohibited this job application from being saved:</h2>
            <ul class="list-disc ml-6 mt-2">
              <% job_application.errors.each do |error| %>
                <li><%= error.full_message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        <div>
          <%= form.label :resume_id, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <div class="flex items-center gap-2">
            <%= form.collection_select :resume_id, @resumes, :id, :title, { prompt: "Select a Resume" }, 
                  class: "block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:resume_id].any?}" %>
            <!-- Uncomment if needed -->
            <!-- <button type="button" class="rounded-md px-3 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100 font-medium transition-colors" data-field-type="resume_id">Add New</button> -->
          </div>
        </div>
        <div>
          <%= form.label :cover_letter_id, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <div class="flex items-center gap-2">
            <%= form.collection_select :cover_letter_id, @cover_letters, :id, :subject, { prompt: "Select a Cover Letter" }, 
                  class: "block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:cover_letter_id].any?}" %>
            <!-- Uncomment if needed -->
            <!-- <button type="button" class="rounded-md px-3 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100 font-medium transition-colors" data-field-type="cover_letter_id">Add New</button> -->
          </div>
        </div>
        <div>
          <%= form.label :status, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <%= form.text_field :status, class: "mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:status].any?}" %>
        </div>
        <div>
          <%= form.label :phase, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <%= form.text_field :phase, class: "mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:phase].any?}" %>
        </div>
        <div>
          <%= form.label :mail, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <%= form.text_field :mail, class: "mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:mail].any?}" %>
        </div>
        <div>
          <%= form.label :applied_at, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <%= form.date_field :applied_at, class: "mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:applied_at].any?}" %>
        </div>
        <div>
          <%= form.label :feedback, class: "block text-sm font-medium text-gray-700 dark:text-gray-300" %>
          <%= form.text_area :feedback, rows: 4, class: "mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-800 dark:text-gray-100 text-gray-900 #{"border-red-400 dark:border-red-600" if job_application.errors[:feedback].any?}" %>
        </div>
        <div class="mt-6">
          <%= form.submit class: "w-full rounded-md px-4 py-2 bg-blue-600 hover:bg-blue-500 dark:bg-blue-700 dark:hover:bg-blue-600 text-white font-medium shadow-md transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500" %>
        </div>
      <% end %>
    </div>
    <!-- Right Column: Previews -->
    <div class="space-y-6">
      <div id="preview-resume-div" class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <h2 class="text-center text-lg font-semibold text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 py-2">Resume</h2>
        <iframe id="resume-preview" style="width: 100%; height: 500px;" frameborder="0"></iframe>
      </div>
      <div id="preview-cover_letter-div" class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
        <h2 class="text-center text-lg font-semibold text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 py-2">Cover Letter</h2>
        <iframe id="cover_letter-preview" style="width: 100%; height: 500px;" frameborder="0"></iframe>
      </div>
    </div>
  </div>
</div>
<script data-controller="applications-resume-preview"></script>
<script data-controller="applications-cover-letter-preview"></script>